description: >
  Lint your codebase with GitHub's Super-Linter.
# What will this job do?
# Descriptions should be short, simple, and clear.

docker:
  - image: 'github/super-linter:<<parameters.version>>'

parameters:
  version:
    type: string
    default: v3
    description: |
      Pick a specific github/super-linter tag:
      https://hub.docker.com/r/github/super-linter/tags
  scan-dir:
    type: string
    default: "."
    description: The relative path in your project to the directory to be linted. By default, all files will be linted.

environment:
  RUN_LOCAL: true
  SCAN_DIR: <<parameters.scan-dir>>
  OUTPUT_FORMAT: tap

working_directory: /tmp/lint

steps:
  - checkout
  - run:
      name: GitHub Super-Linter
      command: |
        # Load Paths
        PATH="${PATH}:/node_modules/.bin:/var/cache/dotnet/tools:/usr/share/dotnet"
        # Set directory
        export DEFAULT_WORKSPACE=$(echo $PWD/$SCAN_DIR)
        echo Scanning $DEFAULT_WORKSPACE
        # Create report directory
        mkdir $PWD/$SCAN_DIR/super-linter.report
        # Run Linter
        bash /action/lib/linter.sh
        # Copy reports
        cp -R $PWD/$SCAN_DIR/super-linter.report /tmp/super-linter.report
  - store_artifacts:
      path: /tmp/super-linter.report
